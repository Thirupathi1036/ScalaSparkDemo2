import json
from pyspark import SparkContext, SparkConf


# js=json.loads(st)
# print js['property']['mprid']
# print js.keys()

# print type(js)

def start():
    st = """{"property": {"lon_3": -145.653, "city": "Glennallen", "listing_id": 7625953320, "mprid": 7776117428, "lon_5": -145.65343, "lon_4": -145.6534, "lon": -145.653438, "zipcode": "99588", "county": "Valdez Cordova", "state": "AK", "href": "Mi-182-Glenn-Hwy_Glennallen_AK_99588_M77761-17428", "status": "off_market", "address": {"city": "Glennallen", "street_name": "Mi 182 Glenn", "street_suffix": "Hwy", "county": "Valdez Cordova", "postal_code": "99588", "address_validation_code": "190", "line": "Mi 182 Glenn Hwy", "state_code": "AK", "location": {"lat": 62.106431, "lon": -145.653438, "accuracy": "address"}}, "lat": 62.106431, "lat_5": 62.10643, "lat_4": 62.1064, "lat_3": 62.106}, "similar_properties": [{"lon_3": -145.653, "baths_half": null, "lon_5": -145.65345, "lon_4": -145.6534, "address": {"city": "Glennallen", "street_name": "Mi 183 Glenn", "street_suffix": "Hwy", "county": "Valdez Cordova", "state": "Alaska", "postal_code": "99588", "location": {"lat": 62.106705, "lon": -145.653451}, "line": "Mi 183 Glenn Hwy", "state_code": "ak", "boundary": {"type": "Point", "coordinates": [-145.653451, 62.106705]}, "address_validation_code": "190"}, "builtup_area": 0, "county": "Valdez Cordova", "href": "Mile-183-Glenn-Hwy_Glennallen_AK_99588_M80538-82753", "baths": 1, "lat_5": 62.1067, "lat_4": 62.1067, "lat_3": 62.106, "city": "Glennallen", "listing_id": 637149815, "list_date": "2018-09-02T04:57:00Z", "lon": -145.653451, "zipcode": "99588", "state": "ak", "type": "single_family", "similarity_score": 204000, "status": "for_sale", "sqft_nearest_100": 1200, "tags": ["central_heat", "forced_air", "garage_1", "garage_1_or_more", "horse_facilities", "single_storey", "single_story"], "price": 82500, "style": "Other - See Remarks", "last_update_date": "2018-09-05T04:25:00Z", "lat": 62.106705, "distance": 0.018936234421122466, "primary_photo": {"href": "http://ap.rdcpix.com/83925755/018ebcdde310da615f4cf0ef998e8d61l-m0s.jpg"}, "year_built": 2003, "mprid": 8053882753, "lot_sqft": 435600, "lot_sqft_percentile": 99, "sqft": 1200, "calculated_fields": {}, "beds": 3, "garage": "1", "stories": 1, "sqft_percentile": null, "age": 15}, {"lon_3": -146.462, "baths_half": null, "lon_5": -146.46227, "lon_4": -146.4622, "address": {"city": "Glennallen", "street_number": "L2", "street_name": "No", "street_suffix": "Rd", "county": "Matanuska Susitna", "state": "Alaska", "postal_code": "99588", "location": {"lat": 62.308784, "lon": -146.462279}, "line": "L2 No Rd", "state_code": "ak", "boundary": {"type": "Point", "coordinates": [-146.462279, 62.308784]}, "address_validation_code": "190"}, "builtup_area": 0, "county": "Matanuska Susitna", "href": "L2-No-Rd_Glennallen_AK_99588_M85172-81996", "baths": 1, "lat_5": 62.30878, "lat_4": 62.3087, "lat_3": 62.308, "city": "Glennallen", "listing_id": 608621351, "list_date": "2016-04-22T23:39:00Z", "lon": -146.462279, "zipcode": "99588", "state": "ak", "type": "single_family", "similarity_score": 223000, "status": "for_sale", "sqft_nearest_100": 1300, "tags": ["central_heat", "forced_air", "garage_1", "garage_1_or_more", "hill_or_mountain_view", "lake_view", "single_storey", "single_story", "view", "water_view", "waterfront"], "price": 325000, "style": "Ranch-Traditional", "last_update_date": "2018-04-17T23:33:00Z", "lat": 62.308784, "distance": 29.571293045464373, "primary_photo": {"href": "http://ap.rdcpix.com/950906529/7ccdc74d71b8f98a2a35c083ad0cf33fl-m0s.jpg"}, "year_built": 2006, "mprid": 8517281996, "lot_sqft": 191664, "lot_sqft_percentile": 84, "sqft": 1307, "calculated_fields": {}, "beds": 2, "garage": "1", "stories": 1, "sqft_percentile": 39, "age": 12}, {"lon_3": -146.063, "baths_half": null, "lon_5": -146.06356, "lon_4": -146.0635, "address": {"city": "Glennallen", "street_name": "Mi 170 1 Glenn", "street_suffix": "Hwy", "county": "Valdez Cordova", "state": "Alaska", "postal_code": "99588", "location": {"lat": 62.099983, "lon": -146.063561}, "line": "Mi 170 1 Glenn Hwy", "state_code": "ak", "boundary": {"type": "Point", "coordinates": [-146.063561, 62.099983]}, "address_validation_code": "190"}, "builtup_area": 2, "county": "Valdez Cordova", "href": "170-1-Glenn-Hwy_Glennallen_AK_99588_M78550-03008", "baths": 3, "lat_5": 62.09998, "lat_4": 62.0999, "lat_3": 62.099, "city": "Glennallen", "listing_id": 631321291, "list_date": "2018-04-03T01:03:00Z", "lon": -146.063561, "zipcode": "99588", "state": "ak", "type": "single_family", "similarity_score": 223000, "status": "for_sale", "sqft_nearest_100": 2200, "tags": ["central_heat", "forced_air", "lake_view", "multi_storey", "two_or_more_stories", "view", "water_view", "waterfront"], "price": 339000, "style": "Two-Story Tradtnl", "last_update_date": "2018-05-03T23:49:00Z", "lat": 62.099983, "distance": 13.265675165098807, "primary_photo": {"href": "http://ap.rdcpix.com/1540726066/aab1dfb47f475c3579e8745d6fd9f2bfl-m0s.jpg"}, "year_built": 1993, "mprid": 7855003008, "lot_sqft": 93654, "lot_sqft_percentile": 80, "sqft": 2240, "calculated_fields": {}, "beds": 3, "garage": null, "stories": 2, "sqft_percentile": null, "age": 25}, {"lon_3": -145.477, "baths_half": null, "lon_5": -145.47776, "lon_4": -145.4777, "address": {"city": "Glennallen", "street_name": "Mi 116 5 Richardson", "street_suffix": "Hwy", "county": "Valdez Cordova", "state": "Alaska", "postal_code": "99588", "location": {"lat": 62.136171, "lon": -145.477766}, "line": "Mi 116 5 Richardson Hwy", "state_code": "ak", "boundary": {"type": "Point", "coordinates": [-145.477766, 62.136171]}, "address_validation_code": "190"}, "builtup_area": 0, "county": "Valdez Cordova", "href": "Mile-116-5-Richardson-Hwy_Glennallen_AK_99588_M78255-42951", "baths": null, "lat_5": 62.13617, "lat_4": 62.1361, "lat_3": 62.136, "city": "Glennallen", "listing_id": 637278991, "list_date": "2018-09-05T23:19:00Z", "lon": -145.477766, "zipcode": "99588", "state": "ak", "type": "single_family", "similarity_score": 223000, "status": "for_sale", "sqft_nearest_100": 900, "tags": ["carport", "single_storey", "single_story"], "price": 85000, "style": "Cabin", "last_update_date": "2018-09-06T18:27:00Z", "lat": 62.136171, "distance": 6.036151744572635, "primary_photo": {"href": "http://ap.rdcpix.com/921034930/77826a034c69036ef3f061d4335d8643l-m0s.jpg"}, "year_built": 2007, "mprid": 7825542951, "lot_sqft": 217800, "lot_sqft_percentile": 92, "sqft": 900, "calculated_fields": {}, "beds": 1, "garage": null, "stories": 1, "sqft_percentile": null, "age": 11}]}"""
    ll = [st]
    return None


def count_properties(in_rdd):
    properties_count_rdd = in_rdd.map(lambda bsp, sp: (bsp["mprid"], 1)).reduceByKey(lambda a, b: a + b)
    return properties_count_rdd


def create():
    conf = SparkConf().setAppName("Count")
    sc = SparkContext(conf=conf)
    st = """{"property": {"lon_3": -145.653, "city": "Glennallen", "listing_id": 7625953320, "mprid": 7776117428, "lon_5": -145.65343, "lon_4": -145.6534, "lon": -145.653438, "zipcode": "99588", "county": "Valdez Cordova", "state": "AK", "href": "Mi-182-Glenn-Hwy_Glennallen_AK_99588_M77761-17428", "status": "off_market", "address": {"city": "Glennallen", "street_name": "Mi 182 Glenn", "street_suffix": "Hwy", "county": "Valdez Cordova", "postal_code": "99588", "address_validation_code": "190", "line": "Mi 182 Glenn Hwy", "state_code": "AK", "location": {"lat": 62.106431, "lon": -145.653438, "accuracy": "address"}}, "lat": 62.106431, "lat_5": 62.10643, "lat_4": 62.1064, "lat_3": 62.106}, "similar_properties": [{"lon_3": -145.653, "baths_half": null, "lon_5": -145.65345, "lon_4": -145.6534, "address": {"city": "Glennallen", "street_name": "Mi 183 Glenn", "street_suffix": "Hwy", "county": "Valdez Cordova", "state": "Alaska", "postal_code": "99588", "location": {"lat": 62.106705, "lon": -145.653451}, "line": "Mi 183 Glenn Hwy", "state_code": "ak", "boundary": {"type": "Point", "coordinates": [-145.653451, 62.106705]}, "address_validation_code": "190"}, "builtup_area": 0, "county": "Valdez Cordova", "href": "Mile-183-Glenn-Hwy_Glennallen_AK_99588_M80538-82753", "baths": 1, "lat_5": 62.1067, "lat_4": 62.1067, "lat_3": 62.106, "city": "Glennallen", "listing_id": 637149815, "list_date": "2018-09-02T04:57:00Z", "lon": -145.653451, "zipcode": "99588", "state": "ak", "type": "single_family", "similarity_score": 204000, "status": "for_sale", "sqft_nearest_100": 1200, "tags": ["central_heat", "forced_air", "garage_1", "garage_1_or_more", "horse_facilities", "single_storey", "single_story"], "price": 82500, "style": "Other - See Remarks", "last_update_date": "2018-09-05T04:25:00Z", "lat": 62.106705, "distance": 0.018936234421122466, "primary_photo": {"href": "http://ap.rdcpix.com/83925755/018ebcdde310da615f4cf0ef998e8d61l-m0s.jpg"}, "year_built": 2003, "mprid": 8053882753, "lot_sqft": 435600, "lot_sqft_percentile": 99, "sqft": 1200, "calculated_fields": {}, "beds": 3, "garage": "1", "stories": 1, "sqft_percentile": null, "age": 15}, {"lon_3": -146.462, "baths_half": null, "lon_5": -146.46227, "lon_4": -146.4622, "address": {"city": "Glennallen", "street_number": "L2", "street_name": "No", "street_suffix": "Rd", "county": "Matanuska Susitna", "state": "Alaska", "postal_code": "99588", "location": {"lat": 62.308784, "lon": -146.462279}, "line": "L2 No Rd", "state_code": "ak", "boundary": {"type": "Point", "coordinates": [-146.462279, 62.308784]}, "address_validation_code": "190"}, "builtup_area": 0, "county": "Matanuska Susitna", "href": "L2-No-Rd_Glennallen_AK_99588_M85172-81996", "baths": 1, "lat_5": 62.30878, "lat_4": 62.3087, "lat_3": 62.308, "city": "Glennallen", "listing_id": 608621351, "list_date": "2016-04-22T23:39:00Z", "lon": -146.462279, "zipcode": "99588", "state": "ak", "type": "single_family", "similarity_score": 223000, "status": "for_sale", "sqft_nearest_100": 1300, "tags": ["central_heat", "forced_air", "garage_1", "garage_1_or_more", "hill_or_mountain_view", "lake_view", "single_storey", "single_story", "view", "water_view", "waterfront"], "price": 325000, "style": "Ranch-Traditional", "last_update_date": "2018-04-17T23:33:00Z", "lat": 62.308784, "distance": 29.571293045464373, "primary_photo": {"href": "http://ap.rdcpix.com/950906529/7ccdc74d71b8f98a2a35c083ad0cf33fl-m0s.jpg"}, "year_built": 2006, "mprid": 8517281996, "lot_sqft": 191664, "lot_sqft_percentile": 84, "sqft": 1307, "calculated_fields": {}, "beds": 2, "garage": "1", "stories": 1, "sqft_percentile": 39, "age": 12}, {"lon_3": -146.063, "baths_half": null, "lon_5": -146.06356, "lon_4": -146.0635, "address": {"city": "Glennallen", "street_name": "Mi 170 1 Glenn", "street_suffix": "Hwy", "county": "Valdez Cordova", "state": "Alaska", "postal_code": "99588", "location": {"lat": 62.099983, "lon": -146.063561}, "line": "Mi 170 1 Glenn Hwy", "state_code": "ak", "boundary": {"type": "Point", "coordinates": [-146.063561, 62.099983]}, "address_validation_code": "190"}, "builtup_area": 2, "county": "Valdez Cordova", "href": "170-1-Glenn-Hwy_Glennallen_AK_99588_M78550-03008", "baths": 3, "lat_5": 62.09998, "lat_4": 62.0999, "lat_3": 62.099, "city": "Glennallen", "listing_id": 631321291, "list_date": "2018-04-03T01:03:00Z", "lon": -146.063561, "zipcode": "99588", "state": "ak", "type": "single_family", "similarity_score": 223000, "status": "for_sale", "sqft_nearest_100": 2200, "tags": ["central_heat", "forced_air", "lake_view", "multi_storey", "two_or_more_stories", "view", "water_view", "waterfront"], "price": 339000, "style": "Two-Story Tradtnl", "last_update_date": "2018-05-03T23:49:00Z", "lat": 62.099983, "distance": 13.265675165098807, "primary_photo": {"href": "http://ap.rdcpix.com/1540726066/aab1dfb47f475c3579e8745d6fd9f2bfl-m0s.jpg"}, "year_built": 1993, "mprid": 7855003008, "lot_sqft": 93654, "lot_sqft_percentile": 80, "sqft": 2240, "calculated_fields": {}, "beds": 3, "garage": null, "stories": 2, "sqft_percentile": null, "age": 25}, {"lon_3": -145.477, "baths_half": null, "lon_5": -145.47776, "lon_4": -145.4777, "address": {"city": "Glennallen", "street_name": "Mi 116 5 Richardson", "street_suffix": "Hwy", "county": "Valdez Cordova", "state": "Alaska", "postal_code": "99588", "location": {"lat": 62.136171, "lon": -145.477766}, "line": "Mi 116 5 Richardson Hwy", "state_code": "ak", "boundary": {"type": "Point", "coordinates": [-145.477766, 62.136171]}, "address_validation_code": "190"}, "builtup_area": 0, "county": "Valdez Cordova", "href": "Mile-116-5-Richardson-Hwy_Glennallen_AK_99588_M78255-42951", "baths": null, "lat_5": 62.13617, "lat_4": 62.1361, "lat_3": 62.136, "city": "Glennallen", "listing_id": 637278991, "list_date": "2018-09-05T23:19:00Z", "lon": -145.477766, "zipcode": "99588", "state": "ak", "type": "single_family", "similarity_score": 223000, "status": "for_sale", "sqft_nearest_100": 900, "tags": ["carport", "single_storey", "single_story"], "price": 85000, "style": "Cabin", "last_update_date": "2018-09-06T18:27:00Z", "lat": 62.136171, "distance": 6.036151744572635, "primary_photo": {"href": "http://ap.rdcpix.com/921034930/77826a034c69036ef3f061d4335d8643l-m0s.jpg"}, "year_built": 2007, "mprid": 7825542951, "lot_sqft": 217800, "lot_sqft_percentile": 92, "sqft": 900, "calculated_fields": {}, "beds": 1, "garage": null, "stories": 1, "sqft_percentile": null, "age": 11}]}"""
    line_rdd = sc.parallelize([st]).map(lambda line: json.loads(line))
    # print line_rdd.first()
    # print line_rdd.map(lambda rr:rr.keys()).take(3)
    # print type(line_rdd.first())

    file_path = "/Users/thirupathi.c/Downloads/MoveData/final_output_om_fs"
    ll = [1, 2, 3, 4, 5]
    n_rdd = sc.parallelize(ll)

    file_rdd = sc.textFile(file_path)
    # print file_rdd.count()
    print(file_rdd.take(1))
    # count_rdd = count_properties(file_rdd)
    # print count_rdd.collect()[0:10]
    return None


if __name__ == '__main__':
    create()
